{"id":"005.1","severity":"error","description":"DataAPI is the ONLY interface for external consumers","scope":"modules/ (excluding modules/data/)","check":"rg \"from modules\\.data\\.(core|storage)\\.\" modules/ --glob \"*.py\" | rg -v \"modules/data/\"","expect":"zero_results","fix":"Replace internal imports with DataAPI method calls. Import from modules.data.api or modules.data.models only."}
{"id":"005.2","severity":"error","description":"Cache backend must implement CacheBackend ABC","scope":"modules/data/storage/","check":"rg \"class \\w+Cache.*CacheBackend\" modules/data/storage/ --glob \"*.py\"","expect":"at_least_one","fix":"All cache implementations must inherit from modules.data.storage.cache_backend.CacheBackend"}
{"id":"005.3","severity":"error","description":"Cache backend selected via factory not hardcoded","scope":"modules/data/core/cache_manager.py","check":"rg \"create_cache_backend\" modules/data/core/cache_manager.py","expect":"at_least_one","fix":"Use create_cache_backend() from modules.data.storage, not direct class instantiation"}
{"id":"005.4","severity":"error","description":"DataAPI exposes all required public methods","scope":"modules/data/api/data_api.py","check":"python -c \"from modules.data.api.data_api import DataAPI; d = DataAPI(); expected = ['close','get_bars','get_bars_bulk','get_bars_detailed','get_data_availability','get_latest_bar','get_latest_bars_bulk','get_registered_symbols','get_symbols','health_check','import_bars','refresh_cache','register_symbol','store_bars','unregister_symbol']; missing = [m for m in expected if not hasattr(d, m)]; print('MISSING: ' + str(missing)) if missing else print('OK')\"","expect":"contains:OK","fix":"Add missing methods to DataAPI as pass-throughs to DataManager"}
{"id":"005.5","severity":"error","description":"Concurrent import uses semaphore for rate limiting","scope":"modules/data/core/data_manager.py","check":"rg \"asyncio\\.Semaphore\" modules/data/core/data_manager.py","expect":"at_least_one","fix":"import_bars_batch must use asyncio.Semaphore(max_concurrent) with asyncio.gather"}
{"id":"005.6","severity":"error","description":"Bar model has no backend-specific factory methods","scope":"modules/data/models/bar.py","check":"rg \"from_influxdb|from_timescaledb|from_redis\" modules/data/models/bar.py","expect":"zero_results","fix":"Remove backend-specific factory methods. Conversion logic belongs in the cache backend implementation."}
{"id":"005.7","severity":"error","description":"Migration files numbered sequentially with no gaps","scope":"scripts/database/migrations/","check":"python -c \"import os, re; files=sorted(f for f in os.listdir('scripts/database/migrations') if f.endswith('.sql')); nums=[int(re.match(r'(\\d+)', f).group(1)) for f in files]; gaps=[i for i in range(nums[0], nums[-1]+1) if i not in nums]; print('GAPS: '+str(gaps)) if gaps else print('OK')\"","expect":"contains:OK","fix":"Renumber migration files to fill gaps"}
{"id":"005.8","severity":"error","description":"Migration list in run_migrations.py matches actual files","scope":"scripts/database/run_migrations.py","check":"python -c \"import re, os; code=open('scripts/database/run_migrations.py').read(); listed=re.findall(r'\\\"(\\d{3}_[^\\\"]+\\.sql)\\\"', code); files=sorted([f for f in os.listdir('scripts/database/migrations') if f.endswith('.sql')]); print('OK') if listed==files else print('MISMATCH listed=' + str(len(listed)) + ' files=' + str(len(files)))\"","expect":"contains:OK","fix":"Update MIGRATIONS list in run_migrations.py to include all .sql files in order"}
{"id":"005.9","severity":"error","description":"DataManager.close() delegates to providers.close_all()","scope":"modules/data/core/data_manager.py","check":"rg \"await self\\.providers\\.close_all\\(\\)\" modules/data/core/data_manager.py","expect":"at_least_one","fix":"DataManager.close() must call await self.providers.close_all() to ensure async cleanup sleep"}
{"id":"005.10","severity":"error","description":"DataManager.close() closes cache pool","scope":"modules/data/core/data_manager.py","check":"rg \"await self\\.cache\\.l2_cache\\.close\\(\\)\" modules/data/core/data_manager.py","expect":"at_least_one","fix":"DataManager.close() must close the cache backend pool via await self.cache.l2_cache.close()"}
